---
title:  受信確認
description:  通信会社に受信確認 (DLR) をリクエストする方法。
navigation_weight:  4

---


受信確認
====

SMS 用 API はリクエストを正常に受信すると、各メッセージにつき`message` オブジェクト配列を 1 つ返します。オブジェクトの `status` は成功を示す「`0`」が最適です。ただしこのステータスは受信者へのメッセージ到達を表すわけではなく、メッセージが送信用キューに入れられたことを示すにすぎません。

次に Nexmo の[適応型ルーティング](https://help.nexmo.com/hc/en-us/articles/218435987-What-is-Nexmo-Adaptive-Routing-)は、メッセージに最適な通信会社を指定します。指定通信会社がメッセージを配信すると、 *受信確認* (DLR) が返されます。

DLR をアプリケーションで受信するには、Nexmo から DLR を受信する [Web フック](/concepts/guides/webhooks)が必要です。[レポート用 API](/reports/overview) を使って定期的に記録 (メッセージごとの配信ステータスを含む) をダウンロードすることもできます。

> **注** : DLR はほとんどの場合メッセージの受信を確認する信頼の置ける方法ですが、受信を 100% 保証するものではありません。[こちらから受信確認の仕組み](#how-delivery-receipts-work)をご覧ください。

受信確認の仕組み
--------

```sequence_diagram
participant Your Application
participant Nexmo
participant Carrier
participant Handset

Your Application->Nexmo: Send an SMS
Nexmo->Carrier: SMS
Carrier->Handset: SMS
Handset->Carrier: Delivery Receipt
Carrier->Nexmo: Delivery Receipt
Nexmo->Your Application: Delivery Receipt Webhook
```

受信確認 (DLR) は次のいずれかのタイミングで返信されます。

* **通信会社** - サービスプロバイダーがメッセージを受信したとき
* **携帯電話** - ユーザーの携帯電話にメッセージが到達したとき

DLR がすべて受信者のメッセージ受領を 100% 保証するとは限りません。配信段階の一部 (別の通信会社へのメッセージ転送など) のみの完了を示す場合もあれば、偽装の場合もあります。そのため Nexmo では DLR の正確性を 100% 保証できません。正確かどうかはメッセージの送信先の[国](/messaging/sms/guides/country-specific-features)や関与するプロバイダーに応じて異なります。

単一 SMS で送信可能な長さを超えているメッセージは[連結](/messaging/sms/guides/concatenation-and-encoding)されます。連結 SMS のパートごとに通信会社から DLR が送信されます。連結メッセージの DLR が携帯電話に届くタイミングは通常のメッセージより遅くなります。送信先の携帯電話で連結メッセージの各パートの処理が完了しないとメッセージ全体の受領を確認できないためです。

受信確認の内容
-------

以下は一般的な DLR です。

```json
{
  "err-code": "0",
  "message-timestamp": "2018-10-25 12:10:29",
  "messageId": "0B00000127FDBC63",
  "msisdn": "447547232824",
  "network-code": "23410",
  "price": "0.03330000",
  "scts": "1810251310",
  "status": "delivered",
  "to": "Nexmo CLI"
}
```

`status` と `err-code` の各フィールドにはメッセージの配信状況とエラーの要因が表示されるため最も重要なフィールドです。

### DLR ステータスメッセージ

DLR の`status`フィールドには SMS が正常に配信されたかどうかが示され、以下の値が表示される可能性があります。

|  `status`   |                    説明                     |
|-------------|-------------------------------------------|
| `accepted`  | メッセージは配信を受け付けましたがまだ配信されていません              |
| `delivered` | メッセージは配信済みです                              |
| `buffered`  | メッセージはバッファリングされ、後で配信されます                  |
| `expired`   | メッセージはダウンストリームの通信会社の再送信方式で保留され、期限内に配信不能です |
| `failed`    | メッセージは配信されませんでした                          |
| `rejected`  | ダウンストリームの通信会社がメッセージの配信を拒否しています            |
| `unknown`   | 関連情報がありません                                |

### DLR エラーコード

DLR の `err-code` フィールドには、配信エラーのトラブルシューティングに役立つ詳細情報が表示されます。コードがゼロの場合を除き、メッセージは配信されなかったことになります。

| `err-code` |       意味        |                                     説明                                     |
|------------|-----------------|----------------------------------------------------------------------------|
| 0          | 配信済み            | メッセージは正常に配信されました                                                           |
| 1          | 不明              | メッセージは配信されませんでした。理由は不明です                                                   |
| 2          | 受信者不在 - 一時的   | 携帯電話が一時的に受信不能であったためメッセージを配信できませんでした。再試行してください                              |
| 3          | 受信者不在 - 永続的   | この電話番号は使用されなくなったためデータベースから削除してください                                         |
| 4          | ユーザーがコールを拒否     | これは永続的エラーであるため、この電話番号をデータベースから削除してください。ユーザーはネットワークオペレーターに拒否の解除を依頼する必要があります |
| 5          | 移植性エラー          | 電話番号の移植性にかかわる問題があります。ネットワークオペレーターに連絡し、問題を解決してください                          |
| 6          | スパム対策フィルターにより拒否 | メッセージは通信会社のスパム対策フィルターによってブロックされました                                         |
| 7          | 携帯電話を使用中        | 現在携帯電話を使用中であるため、メッセージを送信できませんでした。再試行してください                                 |
| 8          | ネットワークエラー       | ネットワークエラーが生じたためメッセージを送信できませんでした。再試行してください                                  |
| 9          | 不正な電話番号         | 受信者は特定サービスからのメッセージを配信しないよう明示的にリクエストしています                                   |
| 10         | 不正メッセージ         | メッセージパラメーターにエラーがあります (例: 不正なエンコードフラグ)                                  |
| 11         | ルーティング不能        | Nexmo はメッセージ配信に適したルートを見つけられません。mailto:api.support@vonage.comに連絡してください      |
| 12         | 送信先に到達不能        | 電話番号へのルートが見つかりません。受信電話番号を確認してください                                          |
| 13         | 受信者の年齢制限        | 年齢が理由で送信先はメッセージを受信できません                                                    |
| 14         | 通信会社が電話番号をブロック  | 受信者は加入プランで SMS が有効になるよう通信会社に依頼する必要があります                                    |
| 15         | プリペイド額が不足       | 受信者はプリペイドプランに加入しており、残額不足でメッセージを受信できません                                     |
| 99         | 一般的エラー          | 通常、ルート内のエラーを指します。mailto:api.support@vonage.comに連絡してください。                   |

> DLR の他のフィールドの説明については、[API の関連情報](/api/sms#delivery-receipt)を参照してください。

SMS 用 API のキャンペーンでの使用
---------------------

メッセージングキャンペーンを開始する前に、[国特有の機能ガイド](/messaging/sms/guides/country-specific-features)で送信先の国について確認します。送信先の国で信頼性の高い DLR が提供されない場合、[コンバージョン用 API](/messaging/conversion-api/overview) を使用して Nexmo のデータポイントを増やし、ルーティング方法を最適化します。

各送信メッセージに参照情報を含めて、顧客やキャンペーンを具体的に特定することもできます。これらの情報は受信確認に含まれます。`client-ref`パラメーターを 40 文字以内で指定して、選択した参照をリクエストに渡します。

関連情報
----

* [Web フックガイド](/concepts/guides/webhooks) — Nexmo プラットフォームと Web フックの併用方法に関する詳細なガイド
* [SMS が配信されない理由](https://help.nexmo.com/hc/en-us/articles/204016013-Why-was-my-SMS-not-delivered-)- トラブルシューティングに役立つヒント

